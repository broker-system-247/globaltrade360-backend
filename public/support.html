<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support - GlobalTrade360</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-chart-line"></i>
                <span>GlobalTrade<span class="logo-highlight">360</span></span>
            </div>
        </div>
        
        <div class="sidebar-user" id="sidebarUser">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-info">
                <h4 id="userName">Loading...</h4>
                <p id="userEmail">Loading...</p>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/dashboard" class="nav-item">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="/ai-chat" class="nav-item">
                <i class="fas fa-robot"></i>
                <span>AI Assistant</span>
            </a>
            <a href="/support" class="nav-item active">
                <i class="fas fa-headset"></i>
                <span>Support</span>
            </a>
            <a href="#" class="nav-item logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </nav>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="topbar">
            <div class="topbar-left">
                <h2>Customer Support</h2>
                <div class="breadcrumb">
                    <span>Home</span>
                    <i class="fas fa-chevron-right"></i>
                    <span>Support</span>
                </div>
            </div>
            <div class="topbar-right">
                <div class="balance-display">
                    <div class="balance-label">Need Help?</div>
                    <div class="balance-amount">We're Here 24/7</div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="support-container">
                <div class="support-main">
                    <div class="support-header">
                        <h3><i class="fas fa-headset"></i> Contact Support Team</h3>
                        <p>Our support team responds within 24 hours. For urgent issues, use the AI Assistant first.</p>
                    </div>
                    
                    <div class="support-form-card">
                        <form id="supportForm">
                            <div class="form-group">
                                <label for="supportSubject">
                                    <i class="fas fa-tag"></i> Subject
                                </label>
                                <input type="text" id="supportSubject" placeholder="What do you need help with?" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="supportMessage">
                                    <i class="fas fa-envelope"></i> Your Message
                                </label>
                                <textarea id="supportMessage" rows="8" placeholder="Describe your issue in detail. Include any error messages or relevant information." required></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-paper-plane"></i> Send Message
                                </button>
                                <button type="button" class="btn btn-outline btn-lg" onclick="goToAIChat()">
                                    <i class="fas fa-robot"></i> Try AI Assistant First
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="support-history" id="supportHistory">
                        <h4><i class="fas fa-history"></i> Your Support History</h4>
                        <div id="messagesList">
                            <!-- Messages load here -->
                        </div>
                    </div>
                </div>
                
                <div class="support-sidebar">
                    <div class="info-card">
                        <div class="info-header">
                            <i class="fas fa-info-circle"></i>
                            <h4>Support Information</h4>
                        </div>
                        <div class="info-content">
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <h5>Response Time</h5>
                                    <p>Typically within 2-24 hours</p>
                                </div>
                            </div>
                            
                            <div class="info-item">
                                <i class="fas fa-envelope"></i>
                                <div>
                                    <h5>Email Support</h5>
                                    <p>support@globaltrade360.com</p>
                                </div>
                            </div>
                            
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <div>
                                    <h5>Phone Support</h5>
                                    <p>+1 (555) 123-4567</p>
                                    <small>Mon-Fri: 9AM-6PM EST</small>
                                </div>
                            </div>
                            
                            <div class="info-item">
                                <i class="fas fa-comments"></i>
                                <div>
                                    <h5>Live Chat</h5>
                                    <p>Available 24/7 via AI Assistant</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="faq-card">
                        <div class="faq-header">
                            <i class="fas fa-question-circle"></i>
                            <h4>Common Issues</h4>
                        </div>
                        <div class="faq-content">
                            <div class="faq-item">
                                <h5>Deposit not showing?</h5>
                                <p>Deposits take 2-10 minutes to confirm. Check blockchain explorer for transaction status.</p>
                            </div>
                            
                            <div class="faq-item">
                                <h5>Withdrawal pending?</h5>
                                <p>Withdrawals require admin approval and are processed within 24 hours.</p>
                            </div>
                            
                            <div class="faq-item">
                                <h5>Trading issues?</h5>
                                <p>Our AI bot may be optimizing trades. Check your trade history for updates.</p>
                            </div>
                            
                            <div class="faq-item">
                                <h5>Account verification?</h5>
                                <p>Contact support with your username and email for verification assistance.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-help-card">
                        <div class="quick-help-header">
                            <i class="fas fa-bolt"></i>
                            <h4>Quick Help</h4>
                        </div>
                        <div class="quick-help-content">
                            <button class="btn btn-block btn-sm" onclick="showDepositHelp()">
                                <i class="fas fa-wallet"></i> Deposit Help
                            </button>
                            <button class="btn btn-block btn-sm" onclick="showWithdrawHelp()">
                                <i class="fas fa-download"></i> Withdraw Help
                            </button>
                            <button class="btn btn-block btn-sm" onclick="showTradeHelp()">
                                <i class="fas fa-robot"></i> Trading Help
                            </button>
                            <button class="btn btn-block btn-sm" onclick="showAccountHelp()">
                                <i class="fas fa-user"></i> Account Help
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Help Modals -->
    <div class="modal" id="depositHelpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-wallet"></i> Deposit Help</h3>
                <button class="modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h4>How to Deposit:</h4>
                <ol>
                    <li>Go to Dashboard â†’ Deposit section</li>
                    <li>Choose your preferred cryptocurrency</li>
                    <li>Copy the wallet address shown</li>
                    <li>Send funds from your external wallet</li>
                    <li>Wait 2-10 minutes for confirmation</li>
                    <li>Your balance will update automatically</li>
                </ol>
                <p><strong>Minimum deposit:</strong> $50 equivalent</p>
                <p><strong>Note:</strong> Send only the specified cryptocurrency to each address</p>
            </div>
        </div>
    </div>
    
    <script>
        let currentUser = null;
        
        async function loadSupportPage() {
            try {
                // Check session
                const sessionRes = await fetch('/api/session');
                const sessionData = await sessionRes.json();
                
                if (!sessionData.authenticated) {
                    window.location.href = '/login';
                    return;
                }
                
                currentUser = sessionData.user;
                
                // Update user info
                document.getElementById('userName').textContent = currentUser.username;
                document.getElementById('userEmail').textContent = currentUser.email;
                
                // Load support history
                await loadSupportHistory();
                
            } catch (error) {
                console.error('Failed to load support page:', error);
            }
        }
        
        async function loadSupportHistory() {
            try {
                // Note: This endpoint needs to be implemented in server.js
                // For now, we'll show a placeholder
                const messagesList = document.getElementById('messagesList');
                messagesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-envelope-open"></i>
                        <p>No support messages yet</p>
                        <p>Send your first message using the form above</p>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load support history:', error);
            }
        }
        
        document.getElementById('supportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const subject = document.getElementById('supportSubject').value;
            const message = document.getElementById('supportMessage').value;
            
            if (!subject || !message) {
                alert('Please fill in all fields');
                return;
            }
            
            try {
                const response = await fetch('/api/support/message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subject, message })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Message sent successfully! We will respond within 24 hours.');
                    this.reset();
                    loadSupportHistory();
                } else {
                    alert('Failed to send message: ' + data.error);
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        });
        
        function goToAIChat() {
            window.location.href = '/ai-chat';
        }
        
        function showDepositHelp() {
            document.getElementById('depositHelpModal').style.display = 'flex';
        }
        
        function showWithdrawHelp() {
            alert('Withdrawals require admin approval. Minimum: $100. Processed within 24 hours.');
        }
        
        function showTradeHelp() {
            alert('AI trading bot works automatically. Minimum trade: $50. Check trade history for results.');
        }
        
        function showAccountHelp() {
            alert('For account issues, contact support with your username and email.');
        }
        
        function closeHelpModal() {
            document.getElementById('depositHelpModal').style.display = 'none';
        }
        
        window.logout = async function() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
            }
        };
        
        // Initialize support page
        document.addEventListener('DOMContentLoaded', loadSupportPage);
    </script>
</body>
</html>
